description: Run tests with optional groups [unit, integration, functional].

parameters:
  pkg-manager:
    type: enum
    enum: ["pipenv", "poetry"]
    default: "pipenv"
    description: Which package management tool to use.
  configure-git:
    type: boolean
    default: false
    description: Whether to setup git credentials.
  test-group:
    type: enum
    enum: ["", "unit", "integration", "functional"]
    default: ""
    description: Which grouped tests to run.

steps:
  - install-cli
  - python-install-venv:
      pkg-manager: << parameters.pkg-manager >>
      configure-git: << parameters.configure-git >>
  - when:
      condition:
        equal: ["", << parameters.test-group >>]
      steps:
        - run:
            name: Run Python tests
            command: noosci python.test --install << parameters.pkg-manager >>
  - unless:
      condition:
        equal: ["", << parameters.test-group >>]
      steps:
        - run:
            name: Run Python tests
            command: noosci python.test --group << parameters.test-group >> --install << parameters.pkg-manager >>
